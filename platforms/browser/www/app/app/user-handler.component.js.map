{"version":3,"file":"user-handler.component.js","sourceRoot":"","sources":["user-handler.component.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,qBAAsC,eAAe,CAAC,CAAA;AACtD,kCAA0D,4BAA4B,CAAC,CAAA;AACvF,sCAAmC,0BAA0B,CAAC,CAAA;AAC9D,8CAAyC,wDAAwD,CAAC,CAAA;AAClG,gCAA6B,qCAAqC,CAAC,CAAA;AACnE,oCAA2B,wBAAwB,CAAC,CAAA;AACpD,+BAA4B,mBAAmB,CAAC,CAAA;AAChD,iCAA8B,4BAA4B,CAAC,CAAA;AAC3D,qCAAoC,yBACpC,CAAC,CAD4D;AAC7D,qBAAwC,eAAe,CAAC,CAAA;AACxD,6BAA6C,cAAc,CAAC,CAAA;AAC5D,2BAA8B,uBAE9B,CAAC,CAFoD;AAYrD;IAQI,8BAAoB,mBAAyC,EAAU,OAAe,EAA+B,IAAc,EAAS,MAAqB;QAA7I,wBAAmB,GAAnB,mBAAmB,CAAsB;QAAU,YAAO,GAAP,OAAO,CAAQ;QAA+B,SAAI,GAAJ,IAAI,CAAU;QAAS,WAAM,GAAN,MAAM,CAAe;QANjK,iBAAY,GAAG,KAAK,CAAC;QACrB,eAAU,GAAG,KAAK,CAAC;QACnB,cAAS,GAAG,KAAK,CAAC;QAClB,eAAU,GAAG,KAAK,CAAC;QACnB,mBAAc,GAAG,KAAK,CAAC;IAE6I,CAAC;IAErK,qCAAM,GAAN;QACI,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,eAAe,EAAE,CAAC;IACtD,CAAC;IAED,yCAAU,GAAV;QACI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;QACnD,IAAI,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC;QACpC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAC1B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QAEvB,EAAE,CAAA,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,gDAAgD,EAAE,QAAQ,CAAC,CAAC;QACpF,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;QAC7D,CAAC;QAED,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;IAChC,CAAC;IAEG,uCAAQ,GAAR;QACI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;IAC7B,CAAC;IAED,2CAAY,GAAZ;QACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAED,0CAAW,GAAX;QACI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IAED,kDAAmB,GAAnB;QACI,EAAE,CAAA,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;YACvB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAC5B,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;QACrC,CAAC;IACL,CAAC;IAED,mDAAoB,GAApB;QACI,IAAI,CAAC,4BAA4B,EAAE,CAAC;QACpC,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;IACvC,CAAC;IAED,0DAA2B,GAA3B;QACI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;IAC7B,CAAC;IAED,gDAAiB,GAAjB;QACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IAED,gDAAiB,GAAjB;QACI,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IAC3B,CAAC;IAED,wCAAS,GAAT;QACI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED,2DAA4B,GAA5B;QACI,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QACnC,EAAE,CAAA,CAAC,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC;YAElB,IAAI,CAAC,GAAG,IAAI,CAAC;YACb,IAAI,GAAG,GAAG,IAAI,QAAQ,CAAC,kDAAkD,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC1F,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ;gBAEhC,IAAI,CAAC,GAAG,IAAI,IAAI,EAAE,CAAC;gBACnB,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,CAAC;gBAEpB,IAAI,UAAU,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;gBAChD,IAAI,aAAa,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;gBAE/B,IAAI,MAAM,GAAG,aAAa,GAAG,UAAU,CAAC;gBAExC,EAAE,CAAA,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC,CAAC;oBACd,CAAC,CAAC,cAAc,GAAG,IAAI,CAAC;oBACxB,CAAC,CAAC,UAAU,EAAE,CAAC;gBAEnB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,IAAI,GAAG,GAAG,IAAI,QAAQ,CAAC,iDAAiD,CAAC,CAAC;oBAC1E,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAS,QAAQ;wBAC/C,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC;4BAC3B,MAAM,EAAE,CAAC;yBAChB,CAAC,CAAC;oBACP,CAAC,CAAC,CAAC;gBACP,CAAC;YACL,CAAC,CAAC,CAAC;QACP,CAAC;IACJ,CAAC;IAlHN;QAAC,gBAAS,CAAC;YACP,QAAQ,EAAE,MAAM,CAAC,EAAE;YACnB,QAAQ,EAAE,cAAc;YACxB,WAAW,EAAE,6BAA6B;YAC1C,SAAS,EAAE,CAAC,4BAA4B,CAAC;YACzC,UAAU,EAAE,CAAC,qCAAiB,EAAE,0DAA0B,EAAE,gCAAc,EAAE,kCAAY,EAAE,8BAAa,EAAE,kCAAe,CAAC;YACzH,OAAO,EAAE,CAAC,gBAAgB,CAAC;YAC3B,SAAS,EAAE,CAAC,0CAAmB,CAAC;SACnC,CAAC;mBAU2F,aAAM,CAAC,0BAAW,CAAC;;4BAV9G;IA2GF,2BAAC;AAAD,CAAC,AAzGD,IAyGC;AAzGY,4BAAoB,uBAyGhC,CAAA","sourcesContent":["import {Component, EventEmitter} from '@angular/core';\nimport {ROUTER_DIRECTIVES, ROUTER_PROVIDERS, Router} from '@angular/router-deprecated';\nimport {AuthorizationService} from \"../authorization.service\";\nimport {CreateUserAccountComponent} from '../createuser.components/create-user-account.component';\nimport {LoginComponent} from '../login.components/login.component';\nimport {Postnote2App} from '../postnote2.component';\nimport {MenuComponent} from '../menu.component';\nimport {LogoutComponent} from '../logout/logout.component';\nimport { LocalStorageService } from '../localstorage.service'\nimport {Input, Inject, Injectable} from '@angular/core';\nimport { defaultFirebase, FirebaseRef } from 'angularfire2';\nimport { ToastsManager } from 'ng2-toastr/ng2-toastr'\n\n@Component({\n    moduleId: module.id,\n    selector: 'user-handler',\n    templateUrl: 'user-handler.component.html',\n    styleUrls: ['user-handler.component.css'],\n    directives: [ROUTER_DIRECTIVES, CreateUserAccountComponent, LoginComponent, Postnote2App, MenuComponent, LogoutComponent],\n    outputs: ['_userLoggedOut'],\n    providers: [LocalStorageService],\n})\n\nexport class UserHandlerComponent {\n    \n    switchWindow = false;\n    loggingOut = false;\n    loggingIn = false;\n    createUser = false;\n    sessionExpired = false;\n    \n    constructor(private _authServiceHandler: AuthorizationService, private _router: Router, @Inject(FirebaseRef) private _ref: Firebase, public toastr: ToastsManager) {}\n\n    isAuth() {\n        return this._authServiceHandler.isAuthenticated();\n    }\n\n    logoutUser() {\n        this._router.parent.navigate(['UserHandlerRoute']); \n        this._authServiceHandler.killAuth();\n        this.switchWindow = false;\n        this.loggingOut = false;\n        this.loggingIn = false;\n\n        if(this.sessionExpired) {\n            this.toastr.warning(\"Your session has expired. Please log in again!\", \"Alert!\");\n        } else {\n            this.toastr.info(\"You've been successfully logged out!\");\n        }\n\n        this.sessionExpired = false;   \n    }\n        \n        switchTo(): boolean {\n            return this.switchWindow;\n        }\n        \n        isLoggingOut(){\n            return this.loggingOut;\n        }\n        \n        isLoggingIn() {\n            return this.loggingIn;\n        }\n        \n        switchToLoginWindow() {\n            if(this.createUser == true) {\n                this.loggingIn = false;\n                this.createUser = false;\n            } else {\n                this.loggingIn = !this.loggingIn;    \n            }\n        }\n        \n        switchToLogoutWindow() {\n            this.checkIfUserSessionHasExpired();\n            this.loggingOut = !this.loggingOut;\n        }\n        \n        switchToCreateAccountWindow() {\n            this.switchWindow = true;\n        }\n        \n        isCreatingAccount() {    \n            return this.createUser;   \n        }\n        \n        createUserAccount() {\n            this.loggingIn = false;\n            this.createUser = true;\n        }\n        \n        loginUser() {\n            this.loggingIn = true;\n            this.createUser = false;\n        }\n        \n        checkIfUserSessionHasExpired() {\n            var authData = this._ref.getAuth();\n            if(authData != null) {\n                \n                var o = this;\n                var ref = new Firebase(\"https://dazzling-fire-7472.firebaseio.com/users/\" + authData.uid);\n                ref.once(\"value\").then((snapshot) => {\n            \n                var d = new Date();          \n                var n = d.getTime();\n            \n                var lastExpire = (snapshot.val().expire / 1000);  \n                var currentExpire = (n / 1000);\n            \n                var result = currentExpire - lastExpire;\n            \n                if(result >= 10) {\n                    o.sessionExpired = true; \n                    o.logoutUser();   \n\n                } else {            \n                    var ref = new Firebase(\"https://dazzling-fire-7472.firebaseio.com/users\");\n                    ref.child(authData.uid).once('value', function(snapshot) {\n                            ref.child(authData.uid).update({\n                                expire: n       \n                        });\n                    });\n                }\n            });            \n        }\n     }\n}"]}