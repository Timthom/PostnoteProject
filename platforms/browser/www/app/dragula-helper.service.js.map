{"version":3,"file":"dragula-helper.service.js","sourceRoot":"","sources":["dragula-helper.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Inject } from '@angular/core';\nimport { AngularFire, defaultFirebase, FirebaseRef, FirebaseListObservable } from 'angularfire2';\nimport { DragulaService } from 'ng2-dragula/ng2-dragula';\nimport {DataService} from './data.service';\nimport { LocalStorageService } from './localstorage.service'\n\n@Injectable()\nexport class DragulaHelperService {\n_notes: any;\n_authData: any;\n// _canSaveSibling: boolean = true;\n_savedSibling: any;\n\n  constructor(private _dataservice: DataService,  @Inject(FirebaseRef) private _ref: Firebase, private _ls: LocalStorageService) {\n    this._authData = this._ref.getAuth();\n    \n    /***** This is only because I dont know how to return the promise from dataservice *****/\n    let authData = this._ref.getAuth();\n   // this._notes = this._ref.child('/users/' + authData.uid + '/notes');\n  }\n\n  /***********************************************************\n  -------------------Dragula stuff below----------------------\n  ***********************************************************/\n  \n  _configureDragula(dragulaService: DragulaService) {\n    dragulaService.setOptions('drag-bag', {\n      isContainer: function (el) {\n        /* Denna skriver ut själva notedivobjectet, här kommer man åt alla element inom notes... */\n        // console.log('isContainer el: ');\n        // console.log(el);\n        \n        return false; // only elements in drake.containers will be taken into account\n      },\n      moves: function (el, source, handle, sibling) {\n       /* \n       el är samma som ovan, den note man håller och alla dess element \n       source kan man se div.classname och alla els inom den diven, inte bara den man håller\n       handle är det element där man tog tag i noten. man kommer åt allt inom också...\n       sibling är den som ligger till höger om noten... om längst till höger så är sibling null...\n       */ \n      //  console.log(`moves, el: `);\n      //  console.log(el);\n      //  console.log(`moves, source: `);\n      //  console.log(source);\n      //  console.log(`moves, handle: `);\n      //  console.log(handle);\n      //  console.log(`moves, sibling: `);\n      //  console.log(sibling);\n       \n        return true; // elements are always draggable by default\n      },\n      accepts: function (el, target, source, sibling) {\n       /* \n       enda nya är target som är det elementet där den släpps...\n       */ \n      //  console.log(`accepts, el: `);\n      //  console.log(el);\n      //  console.log(`accepts, target: `);\n      //  console.log(target);\n      //  console.log(`accepts, source: `);\n      //  console.log(source);\n      //  console.log(`accepts, sibling: `);\n      //  console.log(sibling); \n        \n        return true; // elements can be dropped in any of the `containers` by default\n      },\n      invalid: function (el, handle) {\n      /* \n      inget nytt...\n      */ \n      //  console.log(`invalid, el: `);\n      //  console.log(el);\n      //  console.log(`invalid, handle: `);\n      //  console.log(handle);\n       \n        return false; // don't prevent any drags from initiating by default\n      },\n      direction: 'horizontal',           // Y axis is considered when determining where an element would be dropped\n      copy: false,                       // elements are moved by default, not copied\n      copySortSource: false,             // elements in copy-source containers can be reordered\n      revertOnSpill: false,              // spilling will put the element back where it was dragged from, if this is true\n      removeOnSpill: false,              // spilling will `.remove` the element, if this is true\n      mirrorContainer: document.body,    // set the element that gets mirror elements appended\n      ignoreInputTextSelection: true     // allows users to select input text, see details below\n    });\n    \n    dragulaService.drag.subscribe((value) => {\n      /* \n      man får ut en array med tre index...\n      [0]: namnet på containern...\n      [1]: note.elementet som drogs...\n      [2]: diven som den dras ifrån...\n      */ \n       console.log(`drag, value: `);\n       console.log(value);\n      \n      // if (this._canSaveSibling) {\n        // this._canSaveSibling = false;\n        this._savedSibling = value[1].nextSibling;\n        // console.log('next sibling: ');\n        // console.log(this._savedSibling);\n        // console.log('next sibling id: ');\n        // console.log(this._savedSibling.id);\n        // console.log('next sibling next sibling: ');\n        // console.log(this._savedSibling.nextSibling);\n      // }\n      \n\n\n    });\n    dragulaService.drop.subscribe((value) => {\n      /* \n      man får ut en array med fem index...\n      [0]: namnet på containern...\n      [1]: note.elementet som drogs...\n      [2]: diven som den släpps i...\n      [3]: diven som den dras ifrån...\n      [4]: Sibling, den till höger om där den släpptes... om sist null...\n      */ \n       console.log(`drop, value: `);\n       console.log(value);\n       this.updateEverySiblingOnRight();\n       \n       //Detta ger mig en sträng med id:t...\n       //console.log(value[1].attributes[3].nodeValue);\n       \n       //Detta ger mig namnet på gruppen, varsam på att om man lägger i creator så är den tom...\n       //  console.log(value[2].parentElement.firstElementChild.id);\n       //  console.log(value[2].parentElement.firstElementChild.id === \"\");\n      // this._canSaveSibling = true; \n      let id: string = value[1].attributes[3].nodeValue;\n      let group: string;\n      // console.log(`cosnollen group = ${value[2].parentElement.parentElement.firstElementChild.id}`);\n      if (value[2].parentElement.parentElement.firstElementChild.id === '') {\n        // console.log('group är null');\n        group = 'noGroup'\n      } else {\n        group = value[2].parentElement.parentElement.firstElementChild.id;\n      }\n      // console.log('1');\n\n      // this._notes.child(id).child('group').once('value').then(function(s) {\n      //   let currentGroup = s.val();\n      //   console.log('cg '+ currentGroup)\n        \n      //    if (currentGroup == group) {\n      //       console.log('dropped note in same group will not update group...')\n      //    } else {\n      //      this.updateGroup(id, group);\n      //    }\n  \n      // }); \n      \n      /* Vill göra en kontroll på om den bytte till en annan grupp men måste läsa på om promises mer först... */\n      // console.log('nu testar jag');\n       let currentGroup: any = this._dataservice.getGroupNameFromId(id) ;\n      // console.log('2');\n      // currentGroup.then((result) => (console.log('inne i promisen: ' + result)));\n      // console.log('3');\n      //  console.log(group + ' <--  + currentGroup:');\n      //  console.log('6');\n      //  console.log(currentGroup);\n      //  console.log('7');\n      // if (currentGroup == group) {\n      //   do nothing\n      // } else {\n      // console.log(`id = ${id}, group = ${group}`);\n      if (this._authData != null) {\n        // console.log('inloggad');\n        this._dataservice.changeNoteGroup(id, group);\n      } else {\n        this._ls.changeNoteGroup(id, group);\n      }\n      // }\n      \n    });\n    dragulaService.over.subscribe((value) => {\n      /* \n      man får ut en array med fyra index...\n      [0]: namnet på containern...\n      [1]: note.elementet som drogs...\n      [2]: containern. som den är över ifrån...\n      [3]: containers som den drogs ifrån...\n      */ \n      //  console.log(`over, value: `);\n      //  console.log(value);\n      \n     \n    });\n    dragulaService.out.subscribe((value) => {\n      /* \n      man får ut en array med fyra index...\n      [0]: namnet på containern...\n      [1]: note.elementet som drogs...\n      [2]: containern. som den är över ifrån...\n      [3]: containers som den drogs ifrån...\n      */ \n        // console.log(`out, value: `);\n        // console.log(value);     \n\n    });\n    \n  }\n  \n  updateGroup(id: string, group: string) {\n      if (this._authData) {\n        this._ls.changeNoteGroup(id, group);\n      } else {\n        console.log('inloggad');     \n        this._dataservice.changeNoteGroup(id, group);        \n      }\n  }\n  \n  updateEverySiblingOnRight() {\n    console.log(\"här skall vi uppdatera positionene på this._savedSibling: \");\n    console.log(this._savedSibling);\n    \n    if(this._savedSibling.nextSibling){\n      this._savedSibling = this._savedSibling.nextSibling;\n      this.updateEverySiblingOnRight();\n    }\n  }\n  \n}\n"]}